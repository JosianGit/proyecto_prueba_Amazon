<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Comparador de Barras de Sonido</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 1em;
        }
        h1 {
            text-align: center;
        }
        .grid {
            display: flex;
            flex-direction: column;
            gap: 1em;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 6px rgba(0,0,0,0.08);
            padding: 0.8em;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
        }
        .card-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5em;
        }
        .bloque {
            flex: 1;
            padding: 0.5em;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .bloque.imagen img {
            width: 100px;
            height: auto;
            border-radius: 6px;
        }
        .bloque.valoracion {
            text-align: center;
            font-size: 0.9em;
        }
        .valoracion-numero {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 0.2em;
        }
        .valoracion-texto {
            font-size: 0.85em;
            color: #666;
            margin-top: 0.2em;
        }
        .rating {
            display: flex;
            justify-content: center;
            gap: 0.1em;
        }
        .star {
            font-size: 1.4em;
            background: linear-gradient(to right, #f5c518 var(--fill), #ccc var(--fill));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .bloque.nombre h3 {
            font-size: 1em;
            margin: 0;
        }
        .bloque.nombre p {
            font-size: 0.85em;
            margin: 0.3em 0;
        }
        .mostrar-mas {
            font-size: 0.8em;
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 0.3em;
        }
        .bloque.boton {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .boton {
            background-color: #ff9900;
            color: white;
            padding: 8px 12px;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 0.3em;
            display: inline-block;
        }
        .amazon-logo {
            width: 80px;
            height: auto;
        }
        .info {
            display: none;
            margin-top: 0.8em;
            border-top: 1px solid #ddd;
            padding-top: 0.8em;
            font-size: 0.85em;
        }
        .usuario-bar {
            position: fixed;
            top: 1em;
            right: 1em;
            background-color: #fff;
            padding: 0.5em 1em;
            border-radius: 8px;
            box-shadow: 0 0 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.6em;
            z-index: 1000;
            font-size: 0.9em;
        }
        .usuario-bar svg {
            vertical-align: middle;
        }
        .usuario-bar a {
            background-color: #dc3545;
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
    <script>
        function generarValoraciones() {
            const ratings = document.querySelectorAll('.rating');
            ratings.forEach(rating => {
                const valor = (Math.random() * 9.9).toFixed(1);
                const estrellasNum = parseFloat(valor) / 2;

                let texto = '';
                if (valor < 2) texto = 'Decepcionante';
                else if (valor < 4) texto = 'Normal';
                else if (valor < 6) texto = 'Bueno';
                else if (valor < 8) texto = 'Genial';
                else texto = 'Excepcional';

                let estrellas = '';
                for (let i = 0; i < 5; i++) {
                    let fill = 0;
                    if (estrellasNum >= i + 1) {
                        fill = 100;
                    } else if (estrellasNum > i) {
                        fill = Math.round((estrellasNum - i) * 100);
                    }
                    estrellas += `<span class="star" style="--fill:${fill}%;">★</span>`;
                }

                rating.innerHTML = `
                    <div class="valoracion-numero">${valor}</div>
                    <div class="estrellas">${estrellas}</div>
                    <div class="valoracion-texto">“${texto}”</div>
                `;
            });
        }

        function toggleInfo(id, el) {
            const info = document.getElementById(id);
            const isVisible = info.style.display === 'block';
            info.style.display = isVisible ? 'none' : 'block';
            el.textContent = isVisible ? 'Mostrar más' : 'Mostrar menos';
        }

        window.onload = generarValoraciones;
    </script>
</head>
<body>

{% if username %}
    <div class="usuario-bar">
        <span>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#333" viewBox="0 0 16 16">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                <path fill-rule="evenodd" d="M8 9a5 5 0 0 0-5 5v1h10v-1a5 5 0 0 0-5-5z"/>
            </svg>
            {{ username }}
        </span>
        <a href="{{ path('logout') }}">Cerrar sesión</a>
    </div>
{% endif %}

<h1>Las {{ total }} mejores Barras de Sonido En España</h1>

<div class="grid">
    {% for producto in productos %}
        <div class="card">
            <div class="card-content">
                <div class="bloque imagen">
                    <img src="{{ producto.Images.Primary.Large.URL }}" alt="Imagen del producto">
                </div>
                <div class="bloque valoracion">
                    <div class="rating"></div>
                </div>
                <div class="bloque nombre">
                    <h3>{{ producto.ItemInfo.Title.DisplayValue|slice(0,60) ~ '...' }}</h3>
                    <p><strong>Marca:</strong> {{ producto.ItemInfo.ByLineInfo.Brand.DisplayValue }}</p>
                    <span class="mostrar-mas" onclick="toggleInfo('info{{ loop.index }}', this)">Mostrar más</span>
                </div>
                <div class="bloque boton">
                    <a class="boton" href="{{ producto.DetailPageURL }}" target="_blank">Comprar ahora</a>
                    <img class="amazon-logo" src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg" alt="Amazon logo">
                </div>
            </div>
            <div class="info" id="info{{ loop.index }}">
                <h4>Características:</h4>
                <ul>
                    {% for feature in producto.ItemInfo.Features.DisplayValues %}
                        <li>{{ feature }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endfor %}
</div>

</body>
</html>
